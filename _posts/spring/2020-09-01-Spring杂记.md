---
layout:     post
title:      Spring 杂记
subtitle:   Spring 杂记
date:       2020-09-01
author:     Eagle Cool
header-img: img/post-bg-ios9-web.jpg
catalog: 	true
tags:       Spring
---
# 控制反转（IOC）

系统依赖对象的获得被反转了，由自身实现反转为外部注入。控制反转的实现方式有**依赖注入**和**依赖查找**。
Spring Framework 主要采用**依赖注入**来实现控制反转，但其也实现了*依赖查找*。

# Spring IoC Container

* BeanFactory 提供了一种高级的配置机制，能够管理任何类型的对象。
* ApplicationContext 相较于 BeanFactory 提供了更多的功能，如下：
    * 易于集成 Spring’s AOP
    * 国际化的 Message resource 处理
    * 事件发布
    * 应用层特定的上下文，例如 Web 应用程序中使用的 WebApplicationContext

## BeanFactory

![](https://s1.ax1x.com/2020/09/18/w4Kr5T.png)

### BeanFactory

访问 Spring bean 容器的根接口。

bean 容器的基础客户端视图；ListableBeanFactory and ConfigurableBeanFactory 接口
是可用于特定目的接口。

这个接口被持有许多 bean definitions 的对象实现，每个 bean definition 都被一个唯一的 
beanName 标识。依赖于 bean definition，BeanFactory 将返回一个包含对象的独立实例
(Prototype 设计模式)，或者一个单独的共享实例(一种优于单例设计模式的选择，其中实例是 
Scope 内的单例实例)。返回实例的类型取决于 BeanFactory 的配置：API是相同的。从 
Spring 2.0 开始，更多的 Scope 可以使用在具体的 application context 中(如 Web 
环境的 "request" and "session")。

这种方法的要点是 BeanFactory 是 application components 的注册中心，配置中心(例如，
不再需要单个对象读取属性文件)。

注意，通过使用 setters or constructors 依赖注入 "push" 配置的形式配置对象，而不是
通过 BeanFactory lookup "pull" 配置的形式配置对象。Spring's 依赖注入功能是使用 
BeanFactory 和它的子接口实现的。

通常 BeanFactory 从一个配置源(如，XML)中加载 bean definitions，然后使用 
org.springframework.beans package 去配置 beans。然而，一个实现可以直接在 Java 
代码中返回它根据需要创建的 Java 对象。bean definitions 的存储方式没有任何限制: 
LDAP, RDBMS, XML, properties file 等。鼓励实现支持 bean 之间的引用。

与 ListableBeanFactory 的方法不同，BeanFactory 如果是 HierarchicalBeanFactory 
，那么它的操作总是校验 parent BeanFactory。如果一个 bean 在当前 BeanFactory 中没有
被发现，直接 parent BeanFactory 将被访问。当前 BeanFactory 中的 bean 应该覆盖任何
parent BeanFactory 中同名的 bean。

BeanFactory 的实现应该尽可能的支持标准的 bean 生命周期接口。

initialization methods: 
1. BeanNameAware's setBeanName
2. BeanClassLoaderAware's setBeanClassLoader
3. BeanFactoryAware's setBeanFactory
4. EnvironmentAware's setEnvironment
5. EmbeddedValueResolverAware's setEmbeddedValueResolver
6. ResourceLoaderAware's setResourceLoader (only applicable when running in an application context)
7. ApplicationEventPublisherAware's setApplicationEventPublisher (only applicable when running in an application context)
8. MessageSourceAware's setMessageSource (only applicable when running in an application context)
9. ApplicationContextAware's setApplicationContext (only applicable when running in an application context)
10. ServletContextAware's setServletContext (only applicable when running in a web application context)
11. postProcessBeforeInitialization methods of BeanPostProcessors
12. InitializingBean's afterPropertiesSet
13. a custom init-method definition
14. postProcessAfterInitialization methods of BeanPostProcessors

shutdown methods:
1. postProcessBeforeDestruction methods of DestructionAwareBeanPostProcessors
2. DisposableBean's destroy
3. a custom destroy-method definition

### HierarchicalBeanFactory

BeanFactory 的子接口，是可以成为 hierarchy 的一部分。可以在 
ConfigurableBeanFactory 接口中找到 setParentBeanFactory 方法，该方法允许以可配置
的方式设置 parent。

### ListableBeanFactory

ListableBeanFactory 可以列举出所有 bean 实例，而不是根据客户端的请求逐个尝试按名称查找
bean。预加载所有 bean definitions 的 BeanFactory 实现(如，基于 XML 的 BeanFactory)，
可以实现这个接口。


### AliasRegistry

别名注册表，用于管理别名的公共接口；作为`BeanDefinitionRegistry`的父接口。

### BeanDefinitionRegistry

`BeanDefinition`注册表，用于注册诸如`RootBeanDefinition`和`ChildBeanDefinition`之类的实例。
通常由内部使用AbstractBeanDefinition层次结构的BeanFactory实现。

这仅仅是一个 Spring's bean factory 包中的接口，用于封装`BeanDefinition`的注册。
标准BeanFactory接口仅覆盖对完全配置的工厂实例的访问。

Spring's BeanDefinition 的读取者希望能够处理这个接口的实现。
Spring 核心中已知的实现者是 DefaultListableBeanFactory 和 GenericApplicationContext。









